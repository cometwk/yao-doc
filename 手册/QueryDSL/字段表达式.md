# 字段表达式

## 字段表达式 `Field Expression`

字段表达式可以用于 `select` 、`wheres`、`order`、`group` 等场景；字段表达式数据类型为 `String`，可以为主表字段名称、关联表字段名称、常量、函数等。

### 主表字段

| 类型                      | 表达式语法                                                                                                              |
| ------------------------- | ----------------------------------------------------------------------------------------------------------------------- |
| 主表字段                  | `字段名称`                                                                                                              |
| AES 加密字段              | `*字段名称`                                                                                                             |
| JSON Object 字段          | `$字段名称`, `$字段名称.key`                                                                                            |
| JSON Array 字段           | `@字段名称`, `@字段名称[n]` n 为数组下标                                                                                |
| JSON Array\<Object\> 字段 | `@字段名称`, `$字段名称[n]` n 为数组下标, `@字段名称[n].key` n 为数组下标,`@字段名称[*].key` 返回 `Object.Key` 一维数组 |

### 关联表字段

| 类型                      | 表达式语法                                                                                                                                                                                           |
| ------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 关联表字段                | `关联表名称(或别名).字段名称`                                                                                                                                                                        |
| AES 加密字段              | `关联表名称(或别名).*字段名称`                                                                                                                                                                       |
| JSON Object 字段          | `关联表名称(或别名).$字段名称`, `关联表名称(或别名).$字段名称.key`                                                                                                                                   |
| JSON Array 字段           | `关联表名称(或别名).@字段名称`, `关联表名称(或别名).@字段名称[n]` n 为数组下标                                                                                                                       |
| JSON Array\<Object\> 字段 | `关联表名称(或别名).@字段名称`, `关联表名称(或别名).@字段名称[n]` n 为数组下标, `关联表名称(或别名).@字段名称[n].key` n 为数组下标, `关联表名称(或别名).@字段名称[*].key` 返回 `Object.Key` 一维数组 |

### 函数

| 类型 | 表达式语法                                |
| ---- | ----------------------------------------- |
| 函数 | `:函数名称(参数表...)` 参数为`字段表达式` |

### 常量

| 类型       | 表达式语法   |
| ---------- | ------------ |
| 整型常量   | `整型值`     |
| 浮点型常量 | `浮点型值`   |
| 字符串常量 | `'字符串值'` |

### 别名

| 类型   | 表达式语法                    | 返回值         |
| ------ | ----------------------------- | -------------- |
| 主表   | `字段名称 as 别名`            | `{"别名":...}` |
| 关联表 | `数据表名称.字段名称 as 别名` | `{"别名":...}` |

**说明**

- 字段可以为主表字段名称、关联表字段名称、常量、函数等；关联表字段，需指定关联表名称 `关联表名称.字段名称`。
- 使用 `$` 标识符指定 `JSON Object` 字段。
- 使用 `@` 标识符指定 `JSON Array` 字段。
- 使用 `*` 标识符指定 `AES加密` 字段。
- 使用 `:` 标识符调用数据库提供的查询函数。
- 整型和浮点型常量可以直接使用；如 `1`, `0.618`。
- 使用 `'` 声明选择字段为字符串，如字符串中包含 `'`、`"`或 `\` 使用转义符 `\`转义；如 `北京` 写作 `'北京'`, `北京'"\通州区` 写作 `'北京\'\"\\通州区'`。
- 可以使用 `as` 设置别名，别名支持中文，如设置别名 `select` 查询结果以别名为键值、`wheres`,`order` 等可以视为主表字段使用。如 `name as 姓名`, `short_name as short`, `0.618 as 黄金分割`。

## 表达式示例

| 示例                               | 记录值                                                      | 返回值                     | 说明                                                                                                                         |
| ---------------------------------- | ----------------------------------------------------------- | -------------------------- | ---------------------------------------------------------------------------------------------------------------------------- |
| `"name"`                           | `{"name":"云道天成"}`                                       | `{"name":"云道天成"}`      | 选择 `name` 字段                                                                                                             |
| `"short_name as short"`            | `{"short_name":"象传智慧"}`                                 | `{"short":"象传智慧"}`     | 选择 `short_name` 字段, 返回值字段命名为 `short`                                                                             |
| `"*mobile"`                        | `{"mobile":"B3FE5501344A312773A88160297C34C4"}`             | `{"mobile":"13111119999"}` | 选择 `AES 加密` 字段 `mobile`, 返回解密后的数值 **字段类型必须为 ASE 加密**                                                  |
| `"$extra"`                         | `{"extra":{"sex":"男"}}`                                    | `{"extra":{"sex":"男"}}`   | 选择 `JSON Object` 字段 `extra`, 返回解析后的 Object **字段类型必须为 JSON**                                                 |
| `"$extra.sex as sex"`              | `{"extra":{"sex":"男"}}`                                    | `{"sex":"男"}`             | 选择 `JSON Object` 字段 `extra` key = `sex` 的数值, 返回值字段命名为 `sex` **字段类型必须为 JSON**                           |
| `"@prices"`                        | `{"prices":[100,200,300]}`                                  | `{"prices":[100,200,300]}` | 选择 `JSON Array` 字段 `prices`, 返回解析后的 Array **字段类型必须为 JSON**                                                  |
| `"@prices[0] as price"`            | `{"prices":[100,200,300]}`                                  | `{"price":100}`            | 选择 `JSON Array` 字段 `prices` index = 0 的数值, 返回值字段命名为 `price` **字段类型必须为 JSON**                           |
| `"@addresses[0].id as address_id"` | `{"addresses":[{id:1,"city":"北京"},{id:2,"city":"上海"}]}` | `{"address_id":1}`         | 选择 `JSON Array<Object>` 字段 `addresses` index = 0, key = `id`的数值, 返回值字段命名为`address_id` **字段类型必须为 JSON** |

### 关联表示例

| 示例                                  | 记录值(数据表 t2)                                           | 返回值                     | 说明                                                                                                                                  |
| ------------------------------------- | ----------------------------------------------------------- | -------------------------- | ------------------------------------------------------------------------------------------------------------------------------------- |
| `"t2.name"`                           | `{"name":"象传高新"}`                                       | `{"name":"象传高新"}`      | 选择连接表(`join`) `t2` 的 `name` 字段                                                                                                |
| `"t2.*mobile"`                        | `{"mobile":"B3FE5501344A312773A88160297C34C4"}`             | `{"mobile":"13111119999"}` | 选择 `t2` 的 `AES 加密` 字段 `mobile`, 返回解密后的数值 **字段类型必须为 ASE 加密**                                                   |
| `"t2.short_name as short"`            | `{"short_name":"象传应用引擎"}`                             | `{"short":"象传应用引擎"}` | 选择连接表(`join`) `t2` 的, 返回值字段命名为 `short`                                                                                  |
| `"t2.$extra.sex as sex"`              | `{"extra":{"sex":"男"}}`                                    | `{"sex":"男"}`             | 选择表`t2` 的 `JSON Object` 字段 `extra` key = `sex` 的数值, 返回值字段命名为 `sex` **字段类型必须为 JSON**                           |
| `"t2.@prices[0] as price"`            | `{"prices":[100,200,300]}`                                  | `{"price":100}`            | 选择表`t2` 的 `JSON Array` 字段 `prices` index = 0 的数值, 返回值字段命名为 `price` **字段类型必须为 JSON**                           |
| `"t2.@addresses[0].id as address_id"` | `{"addresses":[{id:1,"city":"北京"},{id:2,"city":"上海"}]}` | `{"address_id":1}`         | 选择表`t2` 的 `JSON Array<Object>` 字段 `addresses` index = 0, key = `id`的数值, 返回值字段命名为`address_id` **字段类型必须为 JSON** |

## 函数示例

| 示例                          | 记录值                          | 返回值               | 说明                                                                |
| ----------------------------- | ------------------------------- | -------------------- | ------------------------------------------------------------------- |
| `":MAX(score) as high_score"` | `{"score":100},{"score":99}...` | `{"high_score":100}` | 使用函数 `MAX` 统计`score`字段最大值, 返回值字段命名为 `high_score` |

## 常量示例

| 示例                       | 记录值 | 返回值                    | 说明                                                                    |
| -------------------------- | ------ | ------------------------- | ----------------------------------------------------------------------- |
| `"1 as price"`             | -      | `{"price":1}`             | 选择整型常量 `1`, 返回值命名为 `price`                                  |
| `"0.618 as price"`         | -      | `{"price":0.618}`         | 选择浮点型常量 `0.618`, 返回值命名为 `price`                            |
| `"'北京' as city"`         | -      | `{"city":"北京"}`         | 选择字符串常量 `北京`, 返回值命名为 `city`                              |
| `"'北京\"\'通州' as town"` | -      | `{"town":"北京\"\'通州"}` | 选择字符串常量 `北京"'通州`, `"`和`'`使用 `\`转义。 返回值命名为 `town` |
| `"'0.618' as str"`         | -      | `{"str":"0.618"}`         | 选择字符串常量 `0.618`, 返回值命名为 `str`                              |
